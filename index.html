
<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>معرض كود فن التكنولوجيا الحديثة</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
  <style>
    :root { --p: #6c5ce7; --s: #a29bfe; --bg: #0f0c29; }
    body{margin:0;background:var(--bg);color:#fff;font-family:Segoe UI,Tahoma,Arial;overflow-x:hidden}
    
    /* ✅ شاشة الصلاة على محمد وآل محمد */
    #splash-screen {
      position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      background: var(--bg); z-index: 10000;
      display: flex; align-items: center; justify-content: center;
      text-align: center; padding: 20px; box-sizing: border-box;
    }
    #splash-screen h2 {
      color: var(--s); font-size: 1.8rem; line-height: 1.6;
      text-shadow: 0 0 15px rgba(162, 155, 254, 0.5);
    }

    /* الواجهة الرئيسية */
    #main-view{padding:18px;max-width:1100px;margin:0 auto; display: none;} /* مخفية حتى تنتهي الشاشة */
    h1{margin:20px 0; text-align:center; font-size:1.4rem; color:var(--s)}
    .grid{display:grid;grid-template-columns:repeat(2, 1fr);gap:12px}

    .card{background:rgba(255,255,255,.08);border:1px solid rgba(255,255,255,.12);border-radius:16px;overflow:hidden;display:flex;flex-direction:column}
    .card img{width:100%;height:140px;object-fit:cover;background:#1a1a2e}
    .p-body{padding:12px;flex-grow:1}
    .t{color:#fff;margin:0 0 5px;font-size:0.95rem;font-weight:bold;height:40px;overflow:hidden}
    
    .meta-info{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px}
    .stars{color:#f1c40f;font-size:0.8rem}
    .price{background:var(--p);padding:2px 8px;border-radius:6px;font-size:0.8rem;font-weight:bold}

    .btns{display:flex;gap:8px}
    .btn{flex:1;text-align:center;padding:10px 2px;border-radius:10px;text-decoration:none;font-weight:800;font-size:0.8rem;cursor:pointer;border:0;color:#fff}
    .btn-demo{background:rgba(255,255,255,.12);border:1px solid rgba(255,255,255,.2)}
    .btn-wa{background:#25D366}

    /* واجهة المعاينة الداخلية */
    #preview-view{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:var(--bg);z-index:999;overflow-y:auto;padding:15px;box-sizing:border-box}
    .back-btn{display:inline-block;padding:10px 20px;background:rgba(255,255,255,.1);border-radius:10px;margin-bottom:15px;cursor:pointer;font-weight:bold}
    .desc-box{margin-top:15px;line-height:1.6;color:#ccc;font-size:0.95rem;white-space:pre-wrap}
    .vids-grid{display:grid;gap:10px;margin-top:15px}
    .vids-grid iframe{width:100%;aspect-ratio:16/9;border-radius:12px;border:0}
    .imgs-grid{display:grid;grid-template-columns:repeat(2, 1fr);gap:10px;margin-top:15px}
    .imgs-grid img{width:100%;height:120px;object-fit:cover;border-radius:12px}

    @media (max-width: 480px) { h1{font-size:1.1rem} .grid{gap:8px} #splash-screen h2{font-size: 1.4rem;} }
  </style>
</head>
<body>

  <div id="splash-screen">
    <h2 id="splash-text">اللهم صل على محمد وآل محمد <br><br> هل صليت على محمد وآل محمد اليوم؟</h2>
  </div>

  <div id="main-view">
    <h1>. معرض كود فن التكلوجيا الحديث اعمالي الخاصة</h1>
    <div id="grid" class="grid"></div>
    <div id="msg" style="text-align:center;margin-top:20px;opacity:0.5"></div>
  </div>

  <div id="preview-view">
    <div class="back-btn" onclick="closePreview()">➔ رجوع للمعرض</div>
    <div id="preview-content"></div>
  </div>

  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyArg6aPnPyd0x5C2HbZ8o5wpVmhmmSYS6Q",
      authDomain: "fn1998.firebaseapp.com",
      projectId: "fn1998",
      storageBucket: "fn1998.firebasestorage.app",
      messagingSenderId: "326727010464",
      appId: "1:326727010464:web:831654b2593ae59d5821c5",
      measurementId: "G-8W5C8ZXJZE"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    const WHATSAPP = "https://wa.me/9647729373260";

    let allItems = [];

    function esc(s){ return (s+"").replace(/[&<>"']/g, m => ({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"}[m])); }

    function extractDriveId(url){
      const m = (url+"").match(/\/file\/d\/([a-zA-Z0-9_-]+)/) || (url+"").match(/[?&]id=([a-zA-Z0-9_-]+)/);
      return (m && m[1]) ? m[1] : "";
    }

    function flipBtn(el, callback) {
      gsap.to(el, { rotationY: 360, duration: 0.5, onComplete: () => {
        gsap.set(el, { rotationY: 0 });
        callback();
      }});
    }

    // ✅ دالة التحميل المعدلة لتناسب الشاشة الترحيبية
    async function load(){
      try {
        const snap = await db.collection("projects").orderBy("createdAt", "desc").get();
        if(snap.empty) { return; }
        
        let html = "";
        allItems = [];
        snap.forEach(doc => {
          const it = doc.data();
          allItems.push(it);
          const idx = allItems.length - 1;
          const thumbId = extractDriveId(it.imageData);
          const thumb = thumbId ? `https://drive.google.com/thumbnail?id=${thumbId}&sz=w800` : it.imageData;
          const starIcon = "★".repeat(it.stars || 5) + "☆".repeat(5 - (it.stars || 5));

          html += `
          <div class="card">
            <img src="${thumb}">
            <div class="p-body">
              <h3 class="t">${esc(it.title)}</h3>
              <div class="meta-info">
                <span class="stars">${starIcon}</span>
                <span class="price">$${it.price || '0'}</span>
              </div>
              <div class="btns">
                <div class="btn btn-demo" onclick="handlePreview(this, ${idx})">معاينة</div>
                <div class="btn btn-wa" onclick="handleWA(this, '${it.whatsappLink || WHATSAPP}')">طلب</div>
              </div>
            </div>
          </div>`;
        });
        document.getElementById("grid").innerHTML = html;
      } catch(e) { console.log("Firebase Error"); }
    }

    // ✅ التحكم في ظهور الشاشة الترحيبية
    window.addEventListener('load', () => {
      load(); // ابدأ تحميل البيانات في الخلفية فوراً
      
      setTimeout(() => {
        gsap.to("#splash-screen", {
          opacity: 0,
          duration: 1,
          onComplete: () => {
            document.getElementById("splash-screen").style.display = "none";
            document.getElementById("main-view").style.display = "block";
            // أنيميشن بسيط لظهور الأعمال
            gsap.from("#main-view", { opacity: 0, y: 20, duration: 1 });
          }
        });
      }, 5000); // 5 ثوانٍ كما طلبت
    });

    window.handlePreview = (el, idx) => {
      flipBtn(el, () => {
        const it = allItems[idx];
        const vids = Array.isArray(it.driveVideos) ? it.driveVideos : [];
        const imgs = Array.isArray(it.driveImages) ? it.driveImages : [];

        let vHtml = vids.map(v => {
          const id = extractDriveId(v);
          return id ? `<iframe src="https://drive.google.com/file/d/${id}/preview"></iframe>` : "";
        }).join("");

        let iHtml = imgs.map(img => {
          const id = extractDriveId(img);
          return id ? `<img src="https://drive.google.com/thumbnail?id=${id}&sz=w1000">` : "";
        }).join("");

        document.getElementById("preview-content").innerHTML = `
          <h2 style="color:var(--s)">${esc(it.title)}</h2>
          <div class="meta-info" style="justify-content:flex-start; gap:20px">
            <span class="stars" style="font-size:1.2rem">${"★".repeat(it.stars || 5)}</span>
            <span class="price" style="font-size:1.1rem">السعر: $${it.price || '0'}</span>
          </div>
          <div class="desc-box">${esc(it.description)}</div>
          <div class="vids-grid">${vHtml}</div>
          <div class="imgs-grid">${iHtml}</div>
          <div style="margin-top:20px">
             ${it.isOpen 
               ? `<a href="${it.demoUrl || '#'}" target="_blank" class="btn btn-demo" style="display:block; margin-bottom:10px; padding:15px; text-decoration:none">دخول للموقع المباشر</a>`
               : `<div style="text-align:center; padding:12px; color:#ff7675; background:rgba(255,118,117,0.1); border-radius:10px; margin-bottom:10px; font-weight:bold; border:1px solid #ff7675">مغلق لخصوصية المالك..</div>`
             }
             <a href="${it.whatsappLink || WHATSAPP}" target="_blank" class="btn btn-wa" style="display:block; padding:15px; text-decoration:none">طلب هذه الخدمة الآن</a>
          </div>
        `;
        document.getElementById("main-view").style.display = "none";
        document.getElementById("preview-view").style.display = "block";
        window.scrollTo(0,0);
      });
    };

    window.handleWA = (el, link) => {
      flipBtn(el, () => { window.open(link, "_blank"); });
    };

    window.closePreview = () => {
      document.getElementById("preview-view").style.display = "none";
      document.getElementById("main-view").style.display = "block";
    };
  </script>
</body>
</html>
